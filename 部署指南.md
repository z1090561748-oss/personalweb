# 网站部署指南

## 方法一：使用 Vercel 部署（推荐，最简单）

### 步骤 1：准备 GitHub 仓库

1. 在 GitHub 创建新仓库
2. 将代码推送到 GitHub：

```bash
git init
git add .
git commit -m "Initial commit"
git branch -M main
git remote add origin https://github.com/你的用户名/你的仓库名.git
git push -u origin main
```

### 步骤 2：部署到 Vercel

1. 访问 https://vercel.com
2. 使用 GitHub 账号登录
3. 点击 "New Project"
4. 选择你的 GitHub 仓库
5. 配置项目：
   - Framework Preset: Next.js（自动检测）
   - Root Directory: `./`
   - Build Command: `npm run build`（自动）
   - Output Directory: `.next`（自动）

### 步骤 3：配置环境变量

在 Vercel 项目设置中添加环境变量：

1. 进入项目 Settings → Environment Variables
2. 添加以下变量：

```
NOTION_API_TOKEN=你的_notion_token
NEXT_PUBLIC_SITE_URL=https://your-project.vercel.app
```

3. 点击 "Save"
4. 重新部署项目（Redeploy）

### 步骤 4：自定义域名（可选）

1. 在 Vercel 项目设置中进入 "Domains"
2. 添加你的域名
3. 按照提示配置 DNS 记录

---

## 方法二：使用 Netlify 部署

### 步骤 1：准备代码

同上，推送到 GitHub

### 步骤 2：部署到 Netlify

1. 访问 https://www.netlify.com
2. 使用 GitHub 账号登录
3. 点击 "New site from Git"
4. 选择你的仓库
5. 配置构建设置：
   - Build command: `npm run build`
   - Publish directory: `.next`

### 步骤 3：配置环境变量

在 Netlify 项目设置中添加环境变量：

1. 进入 Site settings → Environment variables
2. 添加：
   - `NOTION_API_TOKEN`
   - `NEXT_PUBLIC_SITE_URL`

---

## 方法三：使用传统服务器

### 步骤 1：在服务器上安装 Node.js

```bash
# 使用 nvm 安装 Node.js 18+
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 18
nvm use 18
```

### 步骤 2：克隆代码

```bash
git clone https://github.com/你的用户名/你的仓库名.git
cd 你的仓库名
```

### 步骤 3：安装依赖和构建

```bash
npm install
npm run build
```

### 步骤 4：配置环境变量

创建 `.env.production` 文件：

```env
NOTION_API_TOKEN=你的_notion_token
NEXT_PUBLIC_SITE_URL=https://your-domain.com
```

### 步骤 5：使用 PM2 运行（推荐）

```bash
npm install -g pm2
pm2 start npm --name "notion-viewer" -- start
pm2 save
pm2 startup
```

### 步骤 6：配置 Nginx（可选）

创建 `/etc/nginx/sites-available/notion-viewer`：

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

---

## 部署后检查清单

- [ ] 网站可以正常访问
- [ ] Notion 内容可以正常加载
- [ ] 环境变量已正确配置
- [ ] HTTPS 已启用（Vercel/Netlify 自动提供）
- [ ] 提交 sitemap 到 Google Search Console
- [ ] 测试社交媒体分享预览（OG 图片）

## 常见问题

### 1. 构建失败
- 检查 Node.js 版本（需要 18+）
- 检查环境变量是否正确配置
- 查看构建日志中的错误信息

### 2. 内容无法加载
- 确认 Notion API Token 正确
- 确认 Notion 页面已连接到集成
- 检查浏览器控制台的错误信息

### 3. 样式问题
- 清除浏览器缓存
- 检查 CSS 文件是否正确加载

## 推荐部署平台对比

| 平台 | 优点 | 缺点 |
|------|------|------|
| **Vercel** | 专为 Next.js 优化，自动 HTTPS，CDN 全球加速 | 免费版有使用限制 |
| **Netlify** | 功能丰富，持续集成 | 构建时间可能较长 |
| **自建服务器** | 完全控制 | 需要自己维护，配置复杂 |

**推荐使用 Vercel**，因为它由 Next.js 团队开发，对 Next.js 项目支持最好。

